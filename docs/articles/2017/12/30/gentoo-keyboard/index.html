
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Fluxboxのキーボード周りの設定について</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="author" content="Hidetatsu Yaginuma">

  <link href="/markdown.css" rel="stylesheet"></link>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
</head>


<body>
<h2><a href="/">dtyler.io</a></h2>

<h1><a href="/articles/2017/12/30/gentoo-keyboard/">Fluxboxのキーボード周りの設定について</a></h1>

<p>2017/12/30</p>

<p>いろいろ設定した。</p>

<h3>Capslock -&gt; Ctrl</h3>

<p>Capslockは不要なので、Ctrlにする。
<code>xmodmap</code> を使う。 <code>xev</code> も後で使うので入れておく。</p>

<pre><code>$ emerge xmodmap xev
</code></pre>

<p>まず、 <code>Capslock</code> のキーコードを取得する。</p>

<pre><code>$ xev | grep keycode

### Capslockを押す
</code></pre>

<p>筆者の環境では <code>66</code> だった。
あとは設定ファイルで66のキーを <code>Ctrl</code> に変えていく。</p>

<pre><code>$ xmodmap
xmodmap:  up to 4 keys per modifier, (keycodes in parentheses):

shift       Shift_L (0x32),  Shift_R (0x3e)
lock        Caps_Lock (0x42)
control     Control_L (0x25),  Control_R (0x69)
mod1        Alt_L (0x40),  Alt_R (0x6c),  Alt_L (0xcc),  Meta_L (0xcd)
mod2        Num_Lock (0x4d)
mod3  
mod4        Super_L (0x85),  Super_R (0x86),  Super_L (0xce),  Hyper_L (0xcf)
mod5        ISO_Level3_Shift (0x5c),  Mode_switch (0xcb)
</code></pre>

<p>設定ファイルは <code>~/.Xmodmap</code> に書く。</p>

<pre><code>vi .Xmodmap

### 以下記載

remove lock = Caps_Lock

keycode 66 = Control_L

add control = Control_L
</code></pre>

<p>後は <code>xmodmap ~/.Xmodmap</code> することで設定をロードする。
<code>.xinitrc</code> に書くと良い気がするが、fluxboxの場合は <code>~/.fluxbox/startup</code> にすでにロード処理が書いてあったので、
特に何もしていない。</p>

<h3>コロンとセミコロンを入れ替える</h3>

<p>USキーボードは、 <code>L</code> キーの右のキーにコロンとセミコロンが割り振られており、空打ちすると(デフォルトは)セミコロンが入力され、 Shiftキーと同時に押すとコロンになる。
あんまりやってる人を見たことないが、筆者はこれを逆にして、空打ちでコロンになるようにしている。(主にvim及びSlackでの絵文字を打つ時用。)</p>

<p>これは簡単で、さっき作った <code>~/.Xmodmap</code> に以下のように書く。</p>

<pre><code class="language-shell">### 47かどうかは各自確かめる
keycode 47 = colon semicolon Cyrillic_ZHE
</code></pre>

<h3>日本語入力</h3>

<p>日本語を入力できるようにしていく。
<code>fcitx</code> が良いらしいので、使うことにした。インプットメソッドは <code>mozc</code> とする。
まずはツールをインストール。</p>

<pre><code class="language-shell">### gentooには fcitx-mozcがないので、分けてインストール
$ emerge fcitx
$ emerge mozc
$ emerge fcitx-configtool
</code></pre>

<p>なおこの際、<a href="https://wiki.gentoo.org/wiki/Fcitx">wiki</a>によると、gtk2、gtk3、qt4のUSEを立てておくほうがいいらしいのでそのように設定する。</p>

<p>次に日本語フォントをインストール。</p>

<pre><code class="language-shell">$ emerge media-fonts/ja-ipafonts
</code></pre>

<p>次に <code>~/.xinitrc</code> を以下のように編集。</p>

<pre><code class="language-shell">### 必要な環境変数を定義
export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=&quot;@im=fcitx&quot;
### fcitxを起動しておく
fcitx
</code></pre>

<p>これで、X起動時にfcitxが上がる。</p>

<p>最後に、fcitxの設定を行う。</p>

<pre><code class="language-shell">$ fcitx-configtool
</code></pre>

<p>を叩くと設定のウインドウが上がってくる。
<code>入力メソッド</code> に <code>mozc</code> を追加する。</p>

<p>画面から設定してもOKだが、筆者は以下の設定をするために、直接設定ファイルをいじった。</p>

<ul>
<li>スペースキーの左の <code>Alt</code> キーを空打ちしたら日本語入力モードを解除する</li>
<li>スペースキーの右の <code>Alt</code> キーを空打ちしたら日本語入力モードを実行する</li>
</ul>

<p>Macと同じ。</p>

<pre><code class="language-shell">$ vi ~/.config/fcitx/config

### 以下をアンコメントしてR_Altに設定
ActivateKey=R_Alt
### 以下をアンコメントしてL_Altに設定
InactivateKey=L_Alt
</code></pre>

<p>これでいい感じに動いた。</p>

<h3>SandS</h3>

<p>最後にSandS。
SandSとは、スペースキーをShiftキーの様に使用し、大文字や記号入力する、ただしスペース空打ち時は通常のスペースが入力される、というもの。
個人的には必須設定。</p>

<p><a href="https://qiita.com/ychubachi@github/items/95830219f1bdf912280b">こちら</a>を参考にさせていただいた。</p>

<pre><code class="language-shell">$ emerge xcape
$ xcape -d

### Spaceキーを押してキーコード確認

$ vi ~/.fluxbox/startup

### 以下を追記
xcape -e '#65=space'
</code></pre>

<pre><code class="language-shell">$ vi ~/.Xmodmap

### 以下を追記
keycode 255 = space
keycode 65 = Shift_L
</code></pre>

<p>これで設定をリロードするかXを上げ直せばイケるはず。</p>

<h3>まとめ</h3>

<p>色々やりすぎて若干辛い。キーボード設定はやりすぎないのが良いと思う。</p>

</body>

</html>
